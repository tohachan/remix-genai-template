# === enforce-project-structure.yaml ===
id: enforce-project-structure
description: "Enforces Feature-Sliced Design (FSD) architectural methodology within the Remix app/ directory. All code organization must adhere to the standardized FSD structure"
globs:
  - "app/**/*.ts"
  - "app/**/*.tsx"
  - "app/**/*.js"
  - "app/**/*.jsx"
always_apply: true

# Project structure overview
project_structure_overview:
  description: "This project follows Feature-Sliced Design (FSD) architectural methodology within the Remix app/ directory"
  structure: |
    project-root/
    â”œâ”€â”€ app/                    â† Remix application directory
    â”‚   â”œâ”€â”€ shared/            â† FSD shared layer
    â”‚   â”œâ”€â”€ entities/          â† FSD entities layer
    â”‚   â”œâ”€â”€ features/          â† FSD features layer  
    â”‚   â”œâ”€â”€ widgets/           â† FSD widgets layer
    â”‚   â”œâ”€â”€ pages/             â† FSD pages layer
    â”‚   â”œâ”€â”€ routes/            â† Remix routing convention
    â”‚   â”œâ”€â”€ entry.client.tsx   â† Remix entry points
    â”‚   â”œâ”€â”€ entry.server.tsx   â† Remix entry points
    â”‚   â”œâ”€â”€ root.tsx           â† Remix root component
    â”‚   â””â”€â”€ tailwind.css       â† Global styles
    â”œâ”€â”€ public/                â† Static assets
    â”œâ”€â”€ package.json           â† Dependencies
    â””â”€â”€ vite.config.ts         â† Build configuration

# Required layer structure
required_layer_structure:
  description: "The app/ directory **must** contain these FSD layers when applicable:"
  layers:
    shared: "ğŸ“ app/shared/ â€” Reusable functionality detached from business specifics"
    entities: "ğŸ“ app/entities/ â€” Business entities the project works with (user, product, etc.)"
    features: "ğŸ“ app/features/ â€” Reusable product feature implementations that bring business value"
    widgets: "ğŸ“ app/widgets/ â€” Large self-contained UI chunks delivering complete use cases"
    pages: "ğŸ“ app/pages/ â€” Full pages or large page sections for nested routing"
  note: "Not all layers are required, but their names must follow FSD standards exactly."

# Layer-specific rules
layer_specific_rules:
  shared_layer:
    description: "Shared Layer"
    rules:
      - "**NO slices** â€” divide directly into segments"
      - "Structure: `app/shared/[segment]/`"
      - "Example: `app/shared/ui/`, `app/shared/lib/`, `app/shared/api/`"

  entities_features_widgets_pages_layers:
    description: "Entities, Features, Widgets, Pages Layers"
    rules:
      - "**MUST have slices** â€” divide by business domain first"
      - "Structure: `app/[layer]/[slice]/[segment]/`"
      - "Example: `app/pages/home/ui/`, `app/entities/user/model/`, `app/features/auth/api/`"

# Standard segments
standard_segments:
  description: "Use these conventional segment names:"
  segments:
    ui: "`ui/` â€” UI components, formatters, styles"
    api: "`api/` â€” Backend interactions, requests, data types"
    model: "`model/` â€” Data schemas, stores, business logic"
    lib: "`lib/` â€” Slice-specific library code"
    config: "`config/` â€” Configuration files, feature flags"

# Import rules (critical)
import_rules:
  description: "Layer Import Hierarchy (top to bottom):"
  layer_import_hierarchy:
    pages: "`app/pages/` â†’ can import from: widgets, features, entities, shared"
    widgets: "`app/widgets/` â†’ can import from: features, entities, shared"
    features: "`app/features/` â†’ can import from: entities, shared"
    entities: "`app/entities/` â†’ can import from: shared"
    shared: "`app/shared/` â†’ can only import from: shared"

  special_remix_files:
    routes: "`app/routes/` â†’ can import from: pages, widgets, features, entities, shared"
    root: "`app/root.tsx` â†’ can import from: shared (for global styles/providers)"
    entry: "`app/entry.*.tsx` â†’ can import from: shared (for initialization)"

  slice_import_rules:
    description: "Slice Import Rules:"
    rules:
      - "Slices **CANNOT** import from other slices on the same layer"
      - "This ensures high cohesion and low coupling"

# File placement requirements
file_placement_requirements:
  description: "When creating new files in app/, **always**:"
  steps:
    - "**Identify the appropriate layer** based on the code's purpose"
    - "**Create or use existing slice** (except for shared)"
    - "**Choose the correct segment** based on technical purpose"
    - "**Verify import rules** are not violated"

# Examples
examples:
  correct_structure:
    description: "âœ… Correct Structure:"
    structure: |
      app/
      â”œâ”€â”€ shared/
      â”‚   â”œâ”€â”€ ui/button.tsx
      â”‚   â”œâ”€â”€ lib/utils.ts
      â”‚   â””â”€â”€ api/client.ts
      â”œâ”€â”€ entities/
      â”‚   â””â”€â”€ user/
      â”‚       â”œâ”€â”€ model/types.ts
      â”‚       â””â”€â”€ api/requests.ts
      â”œâ”€â”€ features/
      â”‚   â””â”€â”€ auth/
      â”‚       â”œâ”€â”€ ui/LoginForm.tsx
      â”‚       â””â”€â”€ api/login.ts
      â”œâ”€â”€ pages/
      â”‚   â””â”€â”€ home/
      â”‚       â””â”€â”€ ui/index.tsx
      â”œâ”€â”€ routes/
      â”‚   â””â”€â”€ _index.tsx
      â”œâ”€â”€ root.tsx
      â””â”€â”€ tailwind.css

  incorrect_structure:
    description: "âŒ Incorrect:"
    violations:
      - "`app/components/` (use `app/shared/ui/` or appropriate layer)"
      - "`app/utils/` (use `app/shared/lib/`)"
      - "`app/pages/home.tsx` (missing segments, should be `app/pages/home/ui/index.tsx`)"
      - "Cross-layer violations (features importing from widgets)"

# Before adding files
before_adding_files:
  description: "Before adding files, follow these steps:"
  checklist:
    - "**Determine layer** â€” What is this code's primary purpose?"
    - "**Identify slice** â€” What business domain does it belong to? (skip for shared)"
    - "**Choose segment** â€” What technical purpose does it serve?"
    - "**Check imports** â€” Verify no layer/slice rule violations"
    - "**Verify path** â€” Ensure file is inside `app/` directory"

# Remix-specific considerations
remix_specific_considerations:
  description: "Remix-specific considerations:"
  guidelines:
    routes: "**Routes**: Use `app/routes/` for Remix routing, import page components from `app/pages/`"
    global_styles: "**Global Styles**: Keep in `app/` root or `app/shared/ui/`"
    entry_points: "**Entry Points**: `app/entry.*.tsx` and `app/root.tsx` follow Remix conventions"
    build_config: "**Build Config**: `vite.config.ts` stays in project root"

# Route import rules
route_import_rules:
  required_import_pattern_for_pages:
    description: "Route files in `app/routes/` **must** import page components using relative paths:"
    correct_example: |
      // âœ… CORRECT - Relative import to ui/index.tsx
      import UserPage from '../pages/user/ui';
      export default UserPage;

  prohibited_import_patterns:
    description: "**âŒ Do NOT use these import patterns in routes:**"
    wrong_examples:
      named_import: |
        // âŒ WRONG - Named import from root index
        import { UserPage } from '~/pages/user';
      direct_file_import: |
        // âŒ WRONG - Direct file import with extension
        import UserPage from '~/pages/user/ui/user.page.tsx';

  vite_alias_configuration:
    description: "Ensure `vite.config.ts` includes path alias for `~`:"
    example: |
      // vite.config.ts
      import path from 'path';

      export default defineConfig({
        resolve: {
          alias: {
            "~": path.resolve(__dirname, "./app"),
          },
        },
        // ... other config
      });

# What patterns this rule flags as problematic
anti_patterns:
  - "Files placed outside app/ directory structure"
  - "Incorrect layer naming (components/, utils/, helpers/)"
  - "Missing segments in layer structure"
  - "Cross-layer import violations"
  - "Slices importing from other slices on same layer"
  - "Incorrect file placement based on purpose"
  - "Non-FSD compliant directory structure"
  - "Routes using incorrect import patterns"
  - "Missing vite alias configuration"

# Correct approach according to this rule
correct_pattern: |
  **FSD Layer Structure:**
  ```
  app/
  â”œâ”€â”€ shared/[segment]/           # No slices, direct segments
  â”œâ”€â”€ entities/[slice]/[segment]/ # Business entities
  â”œâ”€â”€ features/[slice]/[segment]/ # Product features
  â”œâ”€â”€ widgets/[slice]/[segment]/  # UI chunks
  â”œâ”€â”€ pages/[slice]/[segment]/    # Full pages
  â””â”€â”€ routes/                     # Remix routing
  ```

  **Import Hierarchy:**
  ```tsx
  // Pages can import from all lower layers
  import { UserWidget } from '~/widgets/user';
  import { useAuth } from '~/features/auth';
  import { User } from '~/entities/user';
  import { Button } from '~/shared/ui';

  // Features can only import from entities and shared
  import { User } from '~/entities/user';
  import { apiClient } from '~/shared/api';

  // Entities can only import from shared
  import { httpClient } from '~/shared/lib';
  ```

  **Correct File Placement:**
  ```
  app/shared/ui/Button.tsx        # Reusable UI component
  app/entities/user/model/types.ts # User business entity
  app/features/auth/ui/LoginForm.tsx # Authentication feature
  app/widgets/header/ui/Header.tsx # Header widget
  app/pages/home/ui/index.tsx     # Home page
  ```

# Patterns that trigger this rule
flagged_patterns:
  - "Files in app/components/ instead of app/shared/ui/"
  - "Files in app/utils/ instead of app/shared/lib/"
  - "Direct page files like app/pages/home.tsx"
  - "Cross-layer imports violating hierarchy"
  - "Slice-to-slice imports on same layer"
  - "Named imports from route pages"
  - "Direct file imports with extensions in routes"
  - "Missing ~ alias in vite.config.ts"

# Solutions this rule suggests
suggested_solutions:
  - "Move files to correct FSD layer based on purpose"
  - "Create proper slice/segment structure"
  - "Fix import violations to follow layer hierarchy"
  - "Use relative imports for route page components"
  - "Configure vite alias for ~ path resolution"
  - "Restructure directories to follow FSD conventions"
  - "Separate shared utilities from business logic"
  - "Organize components by business domain in features"

# Cases where this rule doesn't apply
exceptions:
  - "Remix framework files (app/entry.*.tsx, app/root.tsx)"
  - "Global configuration files (tailwind.css)"
  - "Build configuration files (vite.config.ts in root)"
  - "Static assets in public/ directory"
  - "Package configuration (package.json in root)"
  - "Legacy code during migration (temporary)"
  - "Third-party library configurations"

# Benefits of following this rule
benefits:
  - "**Scalability**: Clear structure supports large applications"
  - "**Maintainability**: Predictable file organization"
  - "**Team Collaboration**: Consistent structure across team"
  - "**Code Reusability**: Proper separation enables reuse"
  - "**Import Safety**: Layer hierarchy prevents circular dependencies"
  - "**Business Logic Separation**: Clear boundaries between domains"
  - "**FSD Compliance**: Follows proven architectural methodology"
  - "**Remix Integration**: Works seamlessly with Remix conventions" 